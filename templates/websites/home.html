<!DOCTYPE html>
<html>
<head>
    <style>
        #top_container {
            background-color: #3B4B59;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body id="home">
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="top_container">
        <div class="container-fluid">
            <a href="../" class="navbar-brand">密碼管理</a>
            <ul class="navbar-nav ms-auto">
                <form method="post">
                    <li class="nav-item">
                        <button class="btn btn-secondary ms-lg-2" type="submit" value="button_logout">登出</button>
                    </li>
                </form>
            </ul>
        </div>
    </nav>
    <div class="container" style="margin-top: 7rem;">
        <div class="row">
            <div class="col-12">
                <h2>帳號密碼資訊</h2>
                <p>{{user_name}}{{user_info}}</p>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <button type="button" class="btn btn-primary" id="editButton" onclick="editUser()">編輯</button>
                <button type="submit" class="btn btn-primary d-none" id="saveButton" onclick="saveUser()">完成</button>
                <button type="button" class="btn btn-primary" id="addButton" onclick="addUser()">新增</button>
                <button type="button" class="btn btn-danger" id="deleteButton" onclick="deleteUser()">刪除</button>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12">
                <form id="userForm">
                    <table class="table" id="dataTable">
                        <thead>
                            <tr>
                                <th></th>
                                <th>姓名</th>
                                <th>帳號</th>
                                <th>密碼</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- 表格内容将通过 JavaScript 动态生成 -->
                        </tbody>
                    </table>
                </form>
            </div>
        </div>
    </div>

    <script>
        // 假设您有一个 JSON 文件，其内容如下：
        var jsonData = [
            {
                "姓名": "John Doe",
                "帳號": "johndoe123",
                "密碼": "123"
            },
            {
                "姓名": "Peggy",
                "帳號": "peggy123",
                "密碼": "123"
            }
        ];

        // 在页面加载完成后执行以下操作
        $(document).ready(function () {
            // 获取表格的 tbody 元素
            var tableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];

            for (var i = 0; i < jsonData.length; i++) {
                // 创建新的表格行
                var row = tableBody.insertRow(i);

                // 创建单元格并设置单元格内容
                var radioCell = row.insertCell(0);
                // 为第一个单元格的单选按钮添加属性 checked
                radioCell.innerHTML = '<input type="radio" name="edit-radio" ' + (i === 0 ? 'checked' : '') + '>';

                var nameCell = row.insertCell(1);
                nameCell.innerHTML = '<span>' + jsonData[i].姓名 + '</span><input type="text" class="form-control d-none" name="edit_name">';

                var accountCell = row.insertCell(2);
                accountCell.innerHTML = '<span>' + jsonData[i].帳號 + '</span><input type="text" class="form-control d-none" name="edit_account">';

                var passwordCell = row.insertCell(3);
                passwordCell.innerHTML = '<span>' + jsonData[i].密碼 + '</span><input type="text" class="form-control d-none" name="edit_password">';
            }
        });

        function editUser() {
            // 禁用所有单选按钮
            var radioButtons = document.getElementsByName('edit-radio');
            for (var i = 0; i < radioButtons.length; i++) {
                radioButtons[i].disabled = true;
            }

            var selectedRow = document.querySelector('input[name="edit-radio"]:checked').parentNode.parentNode;
            var nameCell = selectedRow.cells[1];
            var accountCell = selectedRow.cells[2];
            var passwordCell = selectedRow.cells[3];

            // 显示输入框并将内容设置为当前值
            nameCell.querySelector('span').classList.add('d-none');
            nameCell.querySelector('input').classList.remove('d-none');
            nameCell.querySelector('input').value = nameCell.querySelector('span').textContent;

            accountCell.querySelector('span').classList.add('d-none');
            accountCell.querySelector('input').classList.remove('d-none');
            accountCell.querySelector('input').value = accountCell.querySelector('span').textContent;

            passwordCell.querySelector('span').classList.add('d-none');
            passwordCell.querySelector('input').classList.remove('d-none');
            passwordCell.querySelector('input').value = passwordCell.querySelector('span').textContent;

            // 隐藏编辑按钮，显示完成按钮
            document.getElementById('editButton').classList.add('d-none');
            document.getElementById('addButton').classList.add('d-none');
            document.getElementById('deleteButton').classList.add('d-none');
            document.getElementById('saveButton').classList.remove('d-none');
        }

        function saveUser() {
            // 恢复所有单选按钮的状态
            var radioButtons = document.getElementsByName('edit-radio');
            for (var i = 0; i < radioButtons.length; i++) {
                radioButtons[i].disabled = false;
            }

            var selectedRow = document.querySelector('input[name="edit-radio"]:checked').parentNode.parentNode;
            var nameCell = selectedRow.cells[1];
            var accountCell = selectedRow.cells[2];
            var passwordCell = selectedRow.cells[3];

            // 获取输入框的值并设置为新的内容
            var newName = nameCell.querySelector('input').value;
            var newAccount = accountCell.querySelector('input').value;
            var newPassword = passwordCell.querySelector('input').value;

            nameCell.querySelector('span').textContent = newName;
            accountCell.querySelector('span').textContent = newAccount;
            passwordCell.querySelector('span').textContent = newPassword;

            // 隐藏输入框，显示文本内容
            nameCell.querySelector('span').classList.remove('d-none');
            nameCell.querySelector('input').classList.add('d-none');

            accountCell.querySelector('span').classList.remove('d-none');
            accountCell.querySelector('input').classList.add('d-none');

            passwordCell.querySelector('span').classList.remove('d-none');
            passwordCell.querySelector('input').classList.add('d-none');

            // 隐藏完成按钮，显示编辑、新增和删除按钮
            document.getElementById('editButton').classList.remove('d-none');
            document.getElementById('addButton').classList.remove('d-none');
            document.getElementById('deleteButton').classList.remove('d-none');
            document.getElementById('saveButton').classList.add('d-none');
        }

        function addUser() {
            // 禁用所有单选按钮
            var radioButtons = document.getElementsByName('edit-radio');
            for (var i = 0; i < radioButtons.length; i++) {
                radioButtons[i].disabled = true;
            }
            
            var newRow = document.getElementById('dataTable').insertRow(-1);

            var radioCell = newRow.insertCell(0);
            radioCell.innerHTML = '<input type="radio" name="edit-radio" checked>';

            var nameCell = newRow.insertCell(1);
            nameCell.innerHTML = '<span></span><input type="text" class="form-control" name="new_name">';

            var accountCell = newRow.insertCell(2);
            accountCell.innerHTML = '<span></span><input type="text" class="form-control" name="new_account">';

            var passwordCell = newRow.insertCell(3);
            passwordCell.innerHTML = '<span></span><input type="text" class="form-control" name="new_password">';

            // 隐藏编辑按钮，显示完成按钮
            document.getElementById('editButton').classList.add('d-none');
            document.getElementById('addButton').classList.add('d-none');
            document.getElementById('deleteButton').classList.add('d-none');
            document.getElementById('saveButton').classList.remove('d-none');
        }

        function deleteUser() {
            var selectedRow = document.querySelector('input[name="edit-radio"]:checked').parentNode.parentNode;
            selectedRow.parentNode.removeChild(selectedRow);

            // 隐藏完成按钮，显示编辑、新增和删除按钮
            document.getElementById('editButton').classList.remove('d-none');
            document.getElementById('addButton').classList.remove('d-none');
            document.getElementById('deleteButton').classList.remove('d-none');
            document.getElementById('saveButton').classList.add('d-none');
        }
    </script>
</body>
</html>
